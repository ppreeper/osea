

<!doctype html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Ceph &#8212; Enterprise Architecture  documentation</title>
    <link rel="stylesheet" href="../_static/bizstyle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Postgresql" href="postgresql.html" />
    <link rel="prev" title="Benchmarking" href="index.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="postgresql.html" title="Postgresql"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Benchmarking"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Enterprise Architecture  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Benchmarking</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Ceph</a><ul>
<li><a class="reference internal" href="#benchmark-ceph-cluster-performance">Benchmark Ceph Cluster Performance</a><ul>
<li><a class="reference internal" href="#get-baseline-performance-statistics">Get Baseline Performance Statistics</a><ul>
<li><a class="reference internal" href="#benchmark-your-disks">Benchmark Your Disks</a></li>
<li><a class="reference internal" href="#benchmark-your-network">Benchmark Your Network</a></li>
</ul>
</li>
<li><a class="reference internal" href="#benchmark-a-ceph-storage-cluster">Benchmark a Ceph Storage Cluster</a></li>
<li><a class="reference internal" href="#benchmark-a-ceph-block-device">Benchmark a Ceph Block Device</a></li>
<li><a class="reference internal" href="#benchmark-a-ceph-object-gateway">Benchmark a Ceph Object Gateway</a></li>
<li><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ceph-benchmarks">Ceph benchmarks</a><ul>
<li><a class="reference internal" href="#storage-cluster-on-commodity-hardware">Storage cluster on commodity hardware</a><ul>
<li><a class="reference internal" href="#assumptions">Assumptions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#specifications">Specifications</a><ul>
<li><a class="reference internal" href="#servers">Servers</a></li>
<li><a class="reference internal" href="#network">Network</a></li>
<li><a class="reference internal" href="#environement-specifications">Environement specifications</a></li>
</ul>
</li>
<li><a class="reference internal" href="#environment-benchmarks">Environment benchmarks</a><ul>
<li><a class="reference internal" href="#local-disk-benchmarks">Local disk benchmarks</a></li>
<li><a class="reference internal" href="#evaluate-the-network">Evaluate the network</a></li>
<li><a class="reference internal" href="#iperf">Iperf</a></li>
<li><a class="reference internal" href="#netcat">Netcat</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id1">Ceph benchmarks</a><ul>
<li><a class="reference internal" href="#rados-internal-benchmarker">Rados internal benchmarker</a><ul>
<li><a class="reference internal" href="#replica-count-of-2">Replica count of 2</a></li>
<li><a class="reference internal" href="#replica-count-of-3">Replica count of 3</a></li>
<li><a class="reference internal" href="#does-the-number-of-pg-influence-the-performance">Does the number of pg influence the performance?</a></li>
</ul>
</li>
<li><a class="reference internal" href="#osds">OSDs</a><ul>
<li><a class="reference internal" href="#rbd-mapped-devices">RBD mapped devices</a></li>
<li><a class="reference internal" href="#dds">DDs!</a></li>
<li><a class="reference internal" href="#bonnie">Bonnie++</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#commodity-improved">Commodity improved!</a><ul>
<li><a class="reference internal" href="#rados">Rados</a><ul>
<li><a class="reference internal" href="#rados-write">Rados write</a></li>
<li><a class="reference internal" href="#rados-seq">Rados seq</a></li>
</ul>
</li>
<li><a class="reference internal" href="#osd">OSD</a></li>
<li><a class="reference internal" href="#rbd">RBD</a><ul>
<li><a class="reference internal" href="#dd">DD</a></li>
<li><a class="reference internal" href="#id2">Bonnie++</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#middle-edge-servers">Middle-edge servers!</a><ul>
<li><a class="reference internal" href="#id3">SPECIFICATIONS</a><ul>
<li><a class="reference internal" href="#id4">SERVERS</a></li>
<li><a class="reference internal" href="#environment-specifications">ENVIRONMENT SPECIFICATIONS</a></li>
</ul>
</li>
<li><a class="reference internal" href="#environement-benchmarks">ENVIRONEMENT BENCHMARKS</a><ul>
<li><a class="reference internal" href="#id5">LOCAL DISK BENCHMARKS</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">Ceph benchmarks</a><ul>
<li><a class="reference internal" href="#id7">RADOS internal benchmarker</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Benchmarking</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="postgresql.html"
                        title="next chapter">Postgresql</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/benchmarking/ceph.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="ceph">
<h1>Ceph<a class="headerlink" href="#ceph" title="Permalink to this headline">¶</a></h1>
<div class="section" id="benchmark-ceph-cluster-performance">
<h2>Benchmark Ceph Cluster Performance<a class="headerlink" href="#benchmark-ceph-cluster-performance" title="Permalink to this headline">¶</a></h2>
<p>One of the most common questions we hear is “How do I check if my cluster
is running at maximum performance?”. Wonder no more - in this guide, we’ll
walk you through some tools you can use to benchmark your Ceph cluster.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The ideas in this article are based on :</p>
<ul class="simple">
<li><p>Sebastian Han’s blog post <a class="reference external" href="http://www.sebastien-han.fr/blog/2012/08/26/ceph-benchmarks/">http://www.sebastien-han.fr/blog/2012/08/26/ceph-benchmarks/</a></p></li>
<li><p>TelekomCloud’s blog post <a class="reference external" href="https://telekomcloud.github.io/ceph/2014/02/26/ceph-performance-analysis_fio_rbd.html">https://telekomcloud.github.io/ceph/2014/02/26/ceph-performance-analysis_fio_rbd.html</a></p></li>
<li><p>and inputs from Ceph developers and engineers.</p></li>
</ul>
</div>
<div class="section" id="get-baseline-performance-statistics">
<h3>Get Baseline Performance Statistics<a class="headerlink" href="#get-baseline-performance-statistics" title="Permalink to this headline">¶</a></h3>
<p>Fundamentally, benchmarking is all about comparison. You won’t know if you
Ceph cluster is performing below par unless you first identify what its
maximum possible performance is. So, before you start benchmarking your
cluster, you need to obtain baseline performance statistics for the two
main components of your Ceph infrastructure: your disks and your network.</p>
<div class="section" id="benchmark-your-disks">
<h4>Benchmark Your Disks<a class="headerlink" href="#benchmark-your-disks" title="Permalink to this headline">¶</a></h4>
<p>The simplest way to benchmark your disk is with dd. Use the following command
to read and write a file, remembering to add the oflag parameter to bypass
the disk page cache:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">&gt;</span> <span class="n">dd</span> <span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">zero</span> <span class="n">of</span><span class="o">=</span><span class="n">here</span> <span class="n">bs</span><span class="o">=</span><span class="mi">1</span><span class="n">G</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span> <span class="n">oflag</span><span class="o">=</span><span class="n">direct</span>
</pre></div>
</div>
<p>image::https://tracker.ceph.com/attachments/download/1773/image1.png[]</p>
<p>Note the last statistic provided, which indicates disk performance in MB/sec.
Perform this test for each disk in your cluster, noting the results.</p>
</div>
<div class="section" id="benchmark-your-network">
<h4>Benchmark Your Network<a class="headerlink" href="#benchmark-your-network" title="Permalink to this headline">¶</a></h4>
<p>Another key factor affecting Ceph cluster performance is network thoroughput.
A good tool for this is iperf, which uses a client-server connection to
measure TCP and UDP bandwidth.</p>
<p>You can install iperf using apt-get install iperf or yum install iperf.</p>
<p>iperf needs to be installed on at least two nodes in your cluster. Then, on
one of the nodes, start the iperf server using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">&gt;</span> <span class="n">iperf</span> <span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
<p>On another node, start the client with the following command, remembering
to use the IP address of the node hosting the iperf server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">&gt;</span> <span class="n">iperf</span> <span class="o">-</span><span class="n">c</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.1</span>
</pre></div>
</div>
<p>image:https://tracker.ceph.com/attachments/download/1774/image2.png[]</p>
<p>Note the bandwidth statistic in Mbits/sec, as this indicates the maximum
throughput supported by your network.</p>
<p>Now that you have some baseline numbers, you can start benchmarking your
Ceph cluster to see if it’s giving you similar performance. Benchmarking
can be performed at different levels: you can perform low-level
benchmarking of the storage cluster itself, or you can perform higher-level
benchmarking of the key interfaces, such as block devices and object
gateways. The following sections discuss each of these approaches.</p>
<p>NOTE: Before running any of the benchmarks in subsequent sections, drop
all caches using a command like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">echo</span> <span class="mi">3</span> <span class="o">|</span> <span class="n">sudo</span> <span class="n">tee</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">vm</span><span class="o">/</span><span class="n">drop_caches</span> <span class="o">&amp;&amp;</span> <span class="n">sudo</span> <span class="n">sync</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="benchmark-a-ceph-storage-cluster">
<h3>Benchmark a Ceph Storage Cluster<a class="headerlink" href="#benchmark-a-ceph-storage-cluster" title="Permalink to this headline">¶</a></h3>
<p>Ceph includes the rados bench command, designed specifically to benchmark a
RADOS storage cluster. To use it, create a storage pool and then use rados
bench to perform a write benchmark, as shown below.</p>
<p>The rados command is included with Ceph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">&gt;</span> <span class="n">ceph</span> <span class="n">osd</span> <span class="n">pool</span> <span class="n">create</span> <span class="n">scbench</span> <span class="mi">100</span> <span class="mi">100</span>
 <span class="n">shell</span><span class="o">&gt;</span> <span class="n">rados</span> <span class="n">bench</span> <span class="o">-</span><span class="n">p</span> <span class="n">scbench</span> <span class="mi">10</span> <span class="n">write</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">cleanup</span>
</pre></div>
</div>
<p>image:https://tracker.ceph.com/attachments/download/1775/image3.png[]</p>
<p>This creates a new pool named ‘scbench’ and then performs a write benchmark
for 10 seconds. Notice the <cite>–no-cleanup</cite> option, which leaves behind some
data. The output gives you a good indicator of how fast your cluster can write
data.
Two types of read benchmarks are available: seq for sequential reads and
rand for random reads. To perform a read benchmark, use the commands below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">&gt;</span> <span class="n">rados</span> <span class="n">bench</span> <span class="o">-</span><span class="n">p</span> <span class="n">scbench</span> <span class="mi">10</span> <span class="n">seq</span>
 <span class="n">shell</span><span class="o">&gt;</span> <span class="n">rados</span> <span class="n">bench</span> <span class="o">-</span><span class="n">p</span> <span class="n">scbench</span> <span class="mi">10</span> <span class="n">rand</span>
</pre></div>
</div>
<p>image:https://tracker.ceph.com/attachments/download/1776/image4.png[]</p>
<p>You can also add the -t parameter to increase the concurrency of reads and
writes (defaults to 16 threads), or the <cite>-b</cite> parameter to change the size
of the object being written (defaults to 4 MB). It’s also a good idea to
run multiple copies of this benchmark against different pools, to see how
performance changes with multiple clients.</p>
<p>Once you have the data, you can begin comparing the cluster read and write
statistics with the disk-only benchmarks performed earlier, identify how
much of a performance gap exists (if any), and start looking for reasons.</p>
<p>You can clean up the benchmark data left behind by the write benchmark with
this command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">&gt;</span> <span class="n">rados</span> <span class="o">-</span><span class="n">p</span> <span class="n">scbench</span> <span class="n">cleanup</span>
</pre></div>
</div>
</div>
<div class="section" id="benchmark-a-ceph-block-device">
<h3>Benchmark a Ceph Block Device<a class="headerlink" href="#benchmark-a-ceph-block-device" title="Permalink to this headline">¶</a></h3>
<p>If you’re a fan of Ceph block devices, there are two tools you can use to
benchmark their performance. Ceph already includes the rbd bench command,
but you can also use the popular I/O benchmarking tool fio, which now
comes with built in support for RADOS block devices.</p>
<p>The rbd command is included with Ceph. RBD support in fio is relatively
new, therefore you will need to download it from its repository and then
compile and install it`using <cite>configure &amp;&amp; make &amp;&amp; make install</cite>. Note
that you must install the librbd-dev development package with apt-get
install librbd-dev or yum install librbd-dev before compiling fio in
order to activate its RBD support.</p>
<p>Before using either of these two tools, though, create a block device using
the commands below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">&gt;</span> <span class="n">ceph</span> <span class="n">osd</span> <span class="n">pool</span> <span class="n">create</span> <span class="n">rbdbench</span> <span class="mi">100</span> <span class="mi">100</span>
<span class="n">shell</span><span class="o">&gt;</span> <span class="n">rbd</span> <span class="n">create</span> <span class="n">image01</span> <span class="o">--</span><span class="n">size</span> <span class="mi">1024</span> <span class="o">--</span><span class="n">pool</span> <span class="n">rbdbench</span>
<span class="n">shell</span><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">rbd</span> <span class="nb">map</span> <span class="n">image01</span> <span class="o">--</span><span class="n">pool</span> <span class="n">rbdbench</span> <span class="o">--</span><span class="n">name</span> <span class="n">client</span><span class="o">.</span><span class="n">admin</span>
<span class="n">shell</span><span class="o">&gt;</span> <span class="n">sudo</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">mkfs</span><span class="o">.</span><span class="n">ext4</span> <span class="o">-</span><span class="n">m0</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">rbd</span><span class="o">/</span><span class="n">rbdbench</span><span class="o">/</span><span class="n">image01</span>
<span class="n">shell</span><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">ceph</span><span class="o">-</span><span class="n">block</span><span class="o">-</span><span class="n">device</span>
<span class="n">shell</span><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">mount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">rbd</span><span class="o">/</span><span class="n">rbdbench</span><span class="o">/</span><span class="n">image01</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">ceph</span><span class="o">-</span><span class="n">block</span><span class="o">-</span><span class="n">device</span>
</pre></div>
</div>
<p>The rbd bench-write command generates a series of sequential writes to the
image and measure the write throughput and latency. Here’s an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">&gt;</span> <span class="n">rbd</span> <span class="n">bench</span><span class="o">-</span><span class="n">write</span> <span class="n">image01</span> <span class="o">--</span><span class="n">pool</span><span class="o">=</span><span class="n">rbdbench</span>
</pre></div>
</div>
<p>image:https://tracker.ceph.com/attachments/download/1777/image5.png[]</p>
<p>Or, you can use fio to benchmark your block device. An example rbd.fio
template is included with the fio source code, which performs a 4K random
write test against a RADOS block device via librbd. Note that you will
need to update the template with the correct names for your pool and device,
as shown below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="k">global</span><span class="p">]</span>
<span class="n">ioengine</span><span class="o">=</span><span class="n">rbd</span>
<span class="n">clientname</span><span class="o">=</span><span class="n">admin</span>
<span class="n">pool</span><span class="o">=</span><span class="n">rbdbench</span>
<span class="n">rbdname</span><span class="o">=</span><span class="n">image01</span>
<span class="n">rw</span><span class="o">=</span><span class="n">randwrite</span>
<span class="n">bs</span><span class="o">=</span><span class="mi">4</span><span class="n">k</span>
<span class="p">[</span><span class="n">rbd_iodepth32</span><span class="p">]</span>
<span class="n">iodepth</span><span class="o">=</span><span class="mi">32</span>
</pre></div>
</div>
<p>Then, run fio as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">&gt;</span> <span class="n">fio</span> <span class="n">examples</span><span class="o">/</span><span class="n">rbd</span><span class="o">.</span><span class="n">fio</span>
</pre></div>
</div>
<p>image:https://tracker.ceph.com/attachments/download/1778/image6.png[]</p>
</div>
<div class="section" id="benchmark-a-ceph-object-gateway">
<h3>Benchmark a Ceph Object Gateway<a class="headerlink" href="#benchmark-a-ceph-object-gateway" title="Permalink to this headline">¶</a></h3>
<p>When it comes to benchmarking the Ceph object gateway, look no further than
swift-bench, the benchmarking tool included with OpenStack Swift. The
swift-bench tool tests the performance of your Ceph cluster by simulating
client PUT and GET requests and measuring their performance.</p>
<p>You can install swift-bench using pip install swift &amp;&amp; pip install swift-bench.</p>
<p>To use swift-bench, you need to first create a gateway user and subuser,
as shown below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">radosgw</span><span class="o">-</span><span class="n">admin</span> <span class="n">user</span> <span class="n">create</span> <span class="o">--</span><span class="n">uid</span><span class="o">=</span><span class="s2">&quot;benchmark&quot;</span> <span class="o">--</span><span class="n">display</span><span class="o">-</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;benchmark&quot;</span>
<span class="n">shell</span><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">radosgw</span><span class="o">-</span><span class="n">admin</span> <span class="n">subuser</span> <span class="n">create</span> <span class="o">--</span><span class="n">uid</span><span class="o">=</span><span class="n">benchmark</span> <span class="o">--</span><span class="n">subuser</span><span class="o">=</span><span class="n">benchmark</span><span class="p">:</span><span class="n">swift</span> <span class="o">--</span><span class="n">access</span><span class="o">=</span><span class="n">full</span>
<span class="n">shell</span><span class="o">&gt;</span> <span class="n">sudo</span> <span class="n">radosgw</span><span class="o">-</span><span class="n">admin</span> <span class="n">key</span> <span class="n">create</span> <span class="o">--</span><span class="n">subuser</span><span class="o">=</span><span class="n">benchmark</span><span class="p">:</span><span class="n">swift</span> <span class="o">--</span><span class="n">key</span><span class="o">-</span><span class="nb">type</span><span class="o">=</span><span class="n">swift</span> <span class="o">--</span><span class="n">secret</span><span class="o">=</span><span class="n">guessme</span>
<span class="n">shell</span><span class="o">&gt;</span> <span class="n">radosgw</span><span class="o">-</span><span class="n">admin</span> <span class="n">user</span> <span class="n">modify</span> <span class="o">--</span><span class="n">uid</span><span class="o">=</span><span class="n">benchmark</span> <span class="o">--</span><span class="nb">max</span><span class="o">-</span><span class="n">buckets</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<p>Next, create a configuration file for swift-bench on a client host, as below.
Remember to update the authentication URL to reflect that of your Ceph object
gateway and to use the correct user name and credentials.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">bench</span><span class="p">]</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">gateway</span><span class="o">-</span><span class="n">node</span><span class="o">/</span><span class="n">auth</span><span class="o">/</span><span class="n">v1</span><span class="o">.</span><span class="mi">0</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">:</span><span class="n">swift</span>
<span class="n">key</span> <span class="o">=</span> <span class="n">guessme</span>
<span class="n">auth_version</span> <span class="o">=</span> <span class="mf">1.0</span>
</pre></div>
</div>
<p>You can now run a benchmark as below. Use the -c parameter to adjust the
number of concurrent connections (this example uses 64) and the -s parameter
to adjust the size of the object being written (this example uses 4K
objects). The -n and -g parameters control the number of objects to
PUT and GET respectively.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shell</span><span class="o">&gt;</span> <span class="n">swift</span><span class="o">-</span><span class="n">bench</span> <span class="o">-</span><span class="n">c</span> <span class="mi">64</span> <span class="o">-</span><span class="n">s</span> <span class="mi">4096</span> <span class="o">-</span><span class="n">n</span> <span class="mi">1000</span> <span class="o">-</span><span class="n">g</span> <span class="mi">100</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">swift</span><span class="o">.</span><span class="n">conf</span>
</pre></div>
</div>
<p>image:https://tracker.ceph.com/attachments/download/1779/image7.png[]</p>
<p>Although swift-bench measures performance in number of objects/sec, it’s
easy enough to convert this into MB/sec, by multiplying by the size of
each object. However, you should be wary of comparing this directly with
the baseline disk performance statistics you obtained earlier, since
a number of other factors also influence these statistics, such as:</p>
<ul class="simple">
<li><p>the level of replication (and latency overhead)</p></li>
<li><p>full data journal writes (offset in some situations by journal data
coalescing)</p></li>
<li><p>fsync on the OSDs to guarantee data safety</p></li>
<li><p>metadata overhead for keeping data stored in RADOS</p></li>
<li><p>latency overhead (network, ceph, etc) makes readahead more important</p></li>
</ul>
<p>TIP: When it comes to object gateway performance, there’s no hard and
fast rule you can use to easily improve performance. In some cases,
Ceph engineers have been able to obtain better-than-baseline performance
using clever caching and coalescing strategies, whereas in other cases,
object gateway performance has been lower than disk performance due to
latency, fsync and metadata overhead.</p>
</div>
<div class="section" id="conclusion">
<h3>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h3>
<p>There are a number of tools available to benchmark a Ceph cluster, at
different levels: disk, network, cluster, device and gateway. You should
now have some insight into how to approach the benchmarking process and
begin generating performance data for your cluster. Good luck!</p>
<p>link:https://www.sebastien-han.fr/blog/2012/08/26/ceph-benchmarks/</p>
</div>
</div>
<div class="section" id="ceph-benchmarks">
<h2>Ceph benchmarks<a class="headerlink" href="#ceph-benchmarks" title="Permalink to this headline">¶</a></h2>
<p>The time has come to perform some benchmark with Ceph. You expect
(or not), they are there, my Ceph’s benchmarks!</p>
<div class="section" id="storage-cluster-on-commodity-hardware">
<h3>Storage cluster on commodity hardware<a class="headerlink" href="#storage-cluster-on-commodity-hardware" title="Permalink to this headline">¶</a></h3>
<div class="section" id="assumptions">
<h4>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this headline">¶</a></h4>
<p><em>All the benchmark were performed on RBD, I didn’t performed any benchmarks on
CephFS nor RADOSGW.</em></p>
<p>This article is divided into 3 sections where each section implies a different
set of machines or a different configuration. I called them:</p>
<ul class="simple">
<li><p>Old commodity servers</p></li>
<li><p>Old commodity servers improved</p></li>
<li><p>Middle-edge servers</p></li>
<li><p>Insane servers</p></li>
</ul>
<p>Consideration about the ceph’s journal. The journal is by design the component
that could be severely and easily improved. Take a little step back over it.
As a reminder the ceph’s journal serves 2 purposes:</p>
<ul class="simple">
<li><p>It acts as a buffer cache (FIFO buffer). The journal takes every request
and performs each write with O_DIRECT. After a determined period and
acknowledgment the journal flush his content to the backend filesystem.
By default this value is set to 5 seconds and called
<cite>filestore max sync interval</cite>. The filestore starts to flush when the
journal is half-full or max sync interval is reached.</p></li>
<li><p>Failure coverage, pending writes are handled by the Journal if not
committed yet to the backend filesystem.</p></li>
</ul>
<p>The journal can operate in 2 modes called parallel and writeahead, the given
mode is automatically detected according to the file system in use by the OSD
backend storage. The parallel mode is only supported by Btrfs.</p>
<p>In practice, common gigabits network can write 100 MB/sec. Let say that you
store your journal and your backend storage are stored on the same disk. This
disk has a write speed of 100 MB/sec. With the default writeahead mode the
write speed will be split after 5 seconds (the default duration during the
one the journal starts to flush to the backend filesystem).</p>
<p>The first 5 sec writes at 100 MB/sec, after that writes are splitted like so:</p>
<ul class="simple">
<li><p>50 MB/sec for the journal</p></li>
<li><p>50 MB/sec for the backend filesystem</p></li>
</ul>
<p>At the end the ideal size of the journal if you take in consideration random
values like:</p>
<ul class="simple">
<li><p>Disk latencies</p></li>
<li><p>Sector to write</p></li>
<li><p>Who knows what :D</p></li>
</ul>
<p>More information can be found on the ceph wiki.</p>
</div>
</div>
<div class="section" id="specifications">
<h3>Specifications<a class="headerlink" href="#specifications" title="Permalink to this headline">¶</a></h3>
<div class="section" id="servers">
<h4>Servers<a class="headerlink" href="#servers" title="Permalink to this headline">¶</a></h4>
<p>Here the details of my servers:</p>
<ul class="simple">
<li><p>Number of servers: 3</p></li>
<li><p>Hardware type: <em>Dell</em></p></li>
<li><p>Host model: <em>Dell PowerEdge 860</em></p></li>
<li><p>Host CPU: <em>Intel Xeon CPU 3050 &#64; 2.13GHz x2</em></p></li>
<li><p>Host RAM: <em>4G</em></p></li>
<li><dl class="simple">
<dt>Host disks: <em>SEAGATE Model: ST3146855SS</em></dt><dd><ul>
<li><p>2x physical RAID 1 of 146GB &#64; 15K RPM</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Host NIC: <em>Broadcom Corporation NetXtreme BCM5721 Gigabit Ethernet
PCI Express</em></p></li>
</ul>
<p>For more information about the disks used.</p>
</div>
<div class="section" id="network">
<h4>Network<a class="headerlink" href="#network" title="Permalink to this headline">¶</a></h4>
<p>I used one or two private gigabit switches.</p>
<p>Default topology, client writes and OSDs’s replication use the same network
link:</p>
<p>image:http://www.sebastien-han.fr/images/ceph_network_basic_setup.jpg[]</p>
<p>Optimized topology, here the OSD internal replication is handle via the
private switch:</p>
<p>image:http://www.sebastien-han.fr/images/ceph_network_improved_setup.jpg[]</p>
</div>
<div class="section" id="environement-specifications">
<h4>Environement specifications<a class="headerlink" href="#environement-specifications" title="Permalink to this headline">¶</a></h4>
<p>Running softwares and versions:</p>
<ul class="simple">
<li><p>Operating system: Ubuntu Server</p></li>
<li><p>Version: LTS 12.04</p></li>
<li><dl class="simple">
<dt>LVM:</dt><dd><ul>
<li><p>1 tiny LV for the root filesystem (ext4): 20GB</p></li>
<li><p>1 LV of 100G using XFS</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Ceph version: 0.48 Argonaut</p></li>
<li><p>OSDs numbers: 3</p></li>
<li><p>MON numbers: 3</p></li>
<li><dl class="simple">
<dt>Ceph journal:</dt><dd><ul>
<li><p>first stored on each LV</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Ceph journal size: 2G</p></li>
</ul>
<p>My ceph.conf is identical on each node and doesn’t contain any funky options.</p>
</div>
</div>
<div class="section" id="environment-benchmarks">
<h3>Environment benchmarks<a class="headerlink" href="#environment-benchmarks" title="Permalink to this headline">¶</a></h3>
<p>In order to be sure that we don’t have any bootleneck, I started to bench the
cluster environment.</p>
<div class="section" id="local-disk-benchmarks">
<h4>Local disk benchmarks<a class="headerlink" href="#local-disk-benchmarks" title="Permalink to this headline">¶</a></h4>
<p>Always use the oflag=direct in order to use direct I/O. Why? Because the
system maintains a page cache to improve I/O performance. Thanks to this
page cache, every single write operations to the storage system are
considered completed after the data has been copied to the page cache.
The page cache is copied to permanent storage (hard drive disk) using the
system call fsync(2).</p>
<p>We definitely want to bypassed those system cache to get ‘real’ performance
results.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dd if=/dev/zero of=here bs=1G count=1 oflag=direct
1073741824 bytes (1.1 GB) copied, 9.99525 s, 107 MB/s
</pre></div>
</div>
<p>I got the same result on every servers, since all of them have the same
disk model it’s not surprising.</p>
</div>
<div class="section" id="evaluate-the-network">
<h4>Evaluate the network<a class="headerlink" href="#evaluate-the-network" title="Permalink to this headline">¶</a></h4>
<p>First make sure that the network is not source of any bottleneck. For
this purpose we are going to use <cite>iperf</cite> and the swiss knife army <cite>netcat</cite>:</p>
</div>
<div class="section" id="iperf">
<h4>Iperf<a class="headerlink" href="#iperf" title="Permalink to this headline">¶</a></h4>
<p>Iperf will validate the efficient bandwidth between every machines, the
real network connection speed. From on server run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ iperf -s
 ------------------------------------------------------------
 Server listening on TCP port 5001
 TCP window size: 85.3 KByte (default)
 ------------------------------------------------------------
 [  4] local 172.17.1.5 port 5001 connected with 172.17.1.7 port 39815
 [ ID] Interval       Transfer     Bandwidth
 [  4]  0.0-10.0 sec  1.10 GBytes   941 Mbits/sec
</pre></div>
</div>
<p>From an another run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ iperf -c 172.17.1.5 -i1 -t 10
 ------------------------------------------------------------
 Client connecting to 172.17.1.5, TCP port 5001
 TCP window size: 23.5 KByte (default)
 ------------------------------------------------------------
 [  3] local 172.17.1.7 port 39815 connected with 172.17.1.5 port 5001
 [ ID] Interval       Transfer     Bandwidth
 [  3]  0.0- 1.0 sec   116 MBytes   970 Mbits/sec
 [  3]  1.0- 2.0 sec   112 MBytes   944 Mbits/sec
 [  3]  2.0- 3.0 sec   111 MBytes   933 Mbits/sec
 [  3]  3.0- 4.0 sec   113 MBytes   947 Mbits/sec
 [  3]  4.0- 5.0 sec   112 MBytes   935 Mbits/sec
 [  3]  5.0- 6.0 sec   113 MBytes   945 Mbits/sec
 [  3]  6.0- 7.0 sec   112 MBytes   935 Mbits/sec
 [  3]  7.0- 8.0 sec   113 MBytes   946 Mbits/sec
 [  3]  8.0- 9.0 sec   111 MBytes   934 Mbits/sec
 [  3]  9.0-10.0 sec   113 MBytes   946 Mbits/sec
 [  3]  0.0-10.0 sec  1.10 GBytes   943 Mbits/sec

 OK.
</pre></div>
</div>
</div>
<div class="section" id="netcat">
<h4>Netcat<a class="headerlink" href="#netcat" title="Permalink to this headline">¶</a></h4>
<p>Netcat will determine the current bandwidth for the writes. From on server run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ nc -v -v -l -n 2222 &gt;/dev/null
Connection from 172.17.1.8 port 2222 [tcp/*] accepted
</pre></div>
</div>
<p>From an another machine run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ time dd if=/dev/zero | nc -v -v -n 172.17.1.7 2222
Connection to 172.17.1.7 2222 port [tcp/*] succeeded!
^C3991473+0 records in
3991472+0 records out
2043633664 bytes (2.0 GB) copied, 18.1348 s, 113 MB/s

real        0m18.137s
user        0m1.596s
sys 0m15.109s
</pre></div>
</div>
<p>OK.</p>
<ul class="simple">
<li><p>With those simples test you can easily found your bottleneck.</p></li>
</ul>
</div>
</div>
<div class="section" id="id1">
<h3>Ceph benchmarks<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>R Note that every benchmarks have been preceded by the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo echo 3 | sudo tee /proc/sys/vm/drop_caches &amp;&amp; sudo sync
</pre></div>
</div>
<p>The bonnie++ test. Since there is no difference between using all the memory
available and I reduced this value, I did some tests with a generated size
of 8G:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo bonnie++ -s 8192 -r 4096 -u root -d /mnt/ -m BenchClient
</pre></div>
</div>
<p>Every RADOS benchmarks with the internal benchmarker have been done like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rados</span> <span class="n">bench</span> <span class="o">-</span><span class="n">p</span> <span class="n">my_pool</span> <span class="mi">300</span> <span class="n">write</span>
<span class="n">rados</span> <span class="n">bench</span> <span class="o">-</span><span class="n">p</span> <span class="n">my_pool</span> <span class="mi">300</span> <span class="n">seq</span>
</pre></div>
</div>
<div class="section" id="rados-internal-benchmarker">
<h4>Rados internal benchmarker<a class="headerlink" href="#rados-internal-benchmarker" title="Permalink to this headline">¶</a></h4>
<div class="section" id="replica-count-of-2">
<h5>Replica count of 2<a class="headerlink" href="#replica-count-of-2" title="Permalink to this headline">¶</a></h5>
<p>3 OSDs: Writes</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>         <span class="mf">301.488871</span>
<span class="n">Total</span> <span class="n">writes</span> <span class="n">made</span><span class="p">:</span>      <span class="mi">4200</span>
<span class="n">Write</span> <span class="n">size</span><span class="p">:</span>             <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>     <span class="mf">55.723</span>

<span class="n">Stddev</span> <span class="n">Bandwidth</span><span class="p">:</span>       <span class="mf">16.1221</span>
<span class="n">Max</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">100</span>
<span class="n">Min</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">0</span>
<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>        <span class="mf">1.14695</span>
<span class="n">Stddev</span> <span class="n">Latency</span><span class="p">:</span>         <span class="mf">0.510571</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">6.16363</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">0.143685</span>
</pre></div>
</div>
<p>3 OSDs: Sequential</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>        <span class="mf">300.966543</span>
<span class="n">Total</span> <span class="n">reads</span> <span class="n">made</span><span class="p">:</span>     <span class="mi">10528</span>
<span class="n">Read</span> <span class="n">size</span><span class="p">:</span>            <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>    <span class="mf">110.551</span>

<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>       <span class="mf">0.578213</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">1.42949</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">0.085003</span>
</pre></div>
</div>
<p>5 OSDs: Writes</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>     <span class="mf">93.003</span>
</pre></div>
</div>
<p>5 OSDs: Sequential</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>    <span class="mf">111.165</span>
</pre></div>
</div>
<p>We reached the bandwidth limitations with the seq.</p>
</div>
<div class="section" id="replica-count-of-3">
<h5>Replica count of 3<a class="headerlink" href="#replica-count-of-3" title="Permalink to this headline">¶</a></h5>
<p>3 OSDs: Writes</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>         <span class="mf">301.860407</span>
<span class="n">Total</span> <span class="n">writes</span> <span class="n">made</span><span class="p">:</span>      <span class="mi">4221</span>
<span class="n">Write</span> <span class="n">size</span><span class="p">:</span>             <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>     <span class="mf">42.672</span>

<span class="n">Stddev</span> <span class="n">Bandwidth</span><span class="p">:</span>       <span class="mf">11.9161</span>
<span class="n">Max</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">80</span>
<span class="n">Min</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">0</span>
<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>        <span class="mf">1.49945</span>
<span class="n">Stddev</span> <span class="n">Latency</span><span class="p">:</span>         <span class="mf">0.342719</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">3.78959</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">0.399672</span>
</pre></div>
</div>
<p>3 OSDs: Sequential:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>        <span class="mf">300.620169</span>
<span class="n">Total</span> <span class="n">reads</span> <span class="n">made</span><span class="p">:</span>     <span class="mi">8268</span>
<span class="n">Read</span> <span class="n">size</span><span class="p">:</span>            <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>    <span class="mf">110.013</span>

<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>       <span class="mf">0.581603</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">1.43647</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">0.080254</span>
</pre></div>
</div>
</div>
<div class="section" id="does-the-number-of-pg-influence-the-performance">
<h5>Does the number of pg influence the performance?<a class="headerlink" href="#does-the-number-of-pg-influence-the-performance" title="Permalink to this headline">¶</a></h5>
<p>Here I created several pools one by pg num:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1000</span> <span class="n">pg</span><span class="p">:</span> <span class="mf">41.584</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
<span class="mi">2000</span> <span class="n">pg</span><span class="p">:</span> <span class="mf">41.884</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
<span class="mi">5000</span> <span class="n">pg</span><span class="p">:</span> <span class="mf">41.192</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
<span class="mi">10000</span> <span class="n">pg</span><span class="p">:</span> <span class="mf">41.734</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
</pre></div>
</div>
<p>There was absolutly no difference.</p>
</div>
</div>
<div class="section" id="osds">
<h4>OSDs<a class="headerlink" href="#osds" title="Permalink to this headline">¶</a></h4>
<p>This command simulates write from the OSD, which means that you write first on
the journal and then to backend file system. As you can see we are very close
from my assumptions. My network and my disks can both write to ~110 MB/sec.
So the values below are not surprising at all.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo for j in `seq 10`; do for i in 0 1 2; do ceph osd tell $i bench ; done ; done
ok
ok
...
...
</pre></div>
</div>
<p>Average values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">osd</span><span class="o">.</span><span class="mi">0</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">19.109900</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">54870</span> <span class="n">KB</span><span class="o">/</span><span class="n">sec</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">20.755279</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">50520</span> <span class="n">KB</span><span class="o">/</span><span class="n">sec</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">2</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">19.347267</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">54197</span> <span class="n">KB</span><span class="o">/</span><span class="n">sec</span>
</pre></div>
</div>
<div class="section" id="rbd-mapped-devices">
<h5>RBD mapped devices<a class="headerlink" href="#rbd-mapped-devices" title="Permalink to this headline">¶</a></h5>
<p>The following actions have been done on the client machine:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ rados mkpool seb
$ rbd -p seb create --size 20000 seb
$ rbd -p seb map seb
$ mkfs.ext4 /dev/rbd0
$ mount /dev/rbd0 /mnt
</pre></div>
</div>
</div>
<div class="section" id="dds">
<h5>DDs!<a class="headerlink" href="#dds" title="Permalink to this headline">¶</a></h5>
<p>Huge block size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo dd if=/dev/zero of=/mnt/lol bs=1G count=1 oflag=direct
1073741824 bytes (1.1 GB) copied, 48.7659 s, 22.0 MB/s
</pre></div>
</div>
<p>Common block size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo dd if=/dev/zero of=/mnt/lal bs=4M count=1000 oflag=direct
4194304000 bytes (4.2 GB) copied, 231.526 s, 18.1 MB/s
</pre></div>
</div>
</div>
<div class="section" id="bonnie">
<h5>Bonnie++<a class="headerlink" href="#bonnie" title="Permalink to this headline">¶</a></h5>
<p>Bonnie++</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Output</span><span class="o">------</span> <span class="o">--</span><span class="n">Sequential</span> <span class="n">Input</span><span class="o">-</span> <span class="o">--</span><span class="n">Random</span><span class="o">-</span>
<span class="n">Concurrency</span>   <span class="mi">1</span>     <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">-</span><span class="n">Rewrite</span><span class="o">-</span> <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">--</span><span class="n">Seeks</span><span class="o">--</span>
<span class="n">Machine</span>        <span class="n">Size</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
<span class="n">compute02</span>    <span class="mi">32088</span><span class="n">M</span>   <span class="mi">494</span>  <span class="mi">96</span> <span class="mi">21599</span>   <span class="mi">2</span> <span class="mi">10136</span>   <span class="mi">1</span>  <span class="mi">2345</span>  <span class="mi">95</span> <span class="mi">45398</span>   <span class="mi">3</span> <span class="mf">252.7</span>  <span class="mi">15</span>
<span class="n">Latency</span>             <span class="mi">16171</span><span class="n">us</span>    <span class="mi">4590</span><span class="n">ms</span>    <span class="mi">1573</span><span class="n">ms</span>   <span class="mi">38982</span><span class="n">us</span>     <span class="mi">193</span><span class="n">ms</span>     <span class="mi">201</span><span class="n">ms</span>
<span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Create</span><span class="o">------</span> <span class="o">--------</span><span class="n">Random</span> <span class="n">Create</span><span class="o">--------</span>
<span class="n">compute02</span>           <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span> <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span>
            <span class="n">files</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
                <span class="mi">16</span> <span class="mi">11940</span>  <span class="mi">22</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="mi">22407</span>  <span class="mi">32</span> <span class="mi">13639</span>  <span class="mi">24</span> <span class="o">+++++</span> <span class="o">+++</span>  <span class="mi">9377</span>  <span class="mi">13</span>
<span class="n">Latency</span>               <span class="mi">406</span><span class="n">us</span>     <span class="mi">579</span><span class="n">us</span>    <span class="mi">1042</span><span class="n">us</span>     <span class="mi">448</span><span class="n">us</span>      <span class="mi">15</span><span class="n">us</span>     <span class="mi">701</span><span class="n">us</span>
<span class="mf">1.96</span><span class="p">,</span><span class="mf">1.96</span><span class="p">,</span><span class="n">compute02</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1344551648</span><span class="p">,</span><span class="mi">32088</span><span class="n">M</span><span class="p">,,</span><span class="mi">494</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">21599</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">10136</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2345</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">45398</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">252.7</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,,,,,</span><span class="mi">11940</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">22407</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">13639</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">9377</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">16171</span><span class="n">us</span><span class="p">,</span><span class="mi">4590</span><span class="n">ms</span><span class="p">,</span><span class="mi">1573</span><span class="n">ms</span><span class="p">,</span><span class="mi">38982</span><span class="n">us</span><span class="p">,</span><span class="mi">193</span><span class="n">ms</span><span class="p">,</span><span class="mi">201</span><span class="n">ms</span><span class="p">,</span><span class="mi">406</span><span class="n">us</span><span class="p">,</span><span class="mi">579</span><span class="n">us</span><span class="p">,</span><span class="mi">1042</span><span class="n">us</span><span class="p">,</span><span class="mi">448</span><span class="n">us</span><span class="p">,</span><span class="mi">15</span><span class="n">us</span><span class="p">,</span><span class="mi">701</span><span class="n">us</span>
</pre></div>
</div>
<p>With the option: filestore flusher set to false</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Output</span><span class="o">------</span> <span class="o">--</span><span class="n">Sequential</span> <span class="n">Input</span><span class="o">-</span> <span class="o">--</span><span class="n">Random</span><span class="o">-</span>
<span class="n">Concurrency</span>   <span class="mi">1</span>     <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">-</span><span class="n">Rewrite</span><span class="o">-</span> <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">--</span><span class="n">Seeks</span><span class="o">--</span>
<span class="n">Machine</span>        <span class="n">Size</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
<span class="n">Control01</span>        <span class="mi">8</span><span class="n">G</span>   <span class="mi">510</span>  <span class="mi">97</span> <span class="mi">28455</span>   <span class="mi">4</span> <span class="mi">30642</span>   <span class="mi">3</span>  <span class="mi">2436</span>  <span class="mi">95</span> <span class="mi">2728545</span>  <span class="mi">99</span> <span class="mf">696.1</span>  <span class="mi">21</span>
<span class="n">Latency</span>             <span class="mi">15920</span><span class="n">us</span>    <span class="mi">1910</span><span class="n">ms</span>    <span class="mi">3485</span><span class="n">ms</span>    <span class="mi">3206</span><span class="n">us</span>      <span class="mi">61</span><span class="n">us</span>    <span class="mi">7308</span><span class="n">us</span>
<span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Create</span><span class="o">------</span> <span class="o">--------</span><span class="n">Random</span> <span class="n">Create</span><span class="o">--------</span>
<span class="n">Control01</span>           <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span> <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span>
            <span class="n">files</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
                <span class="mi">16</span> <span class="mi">23726</span>  <span class="mi">46</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="mi">32471</span>  <span class="mi">53</span> <span class="mi">26351</span>  <span class="mi">50</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="mi">23727</span>  <span class="mi">39</span>
<span class="n">Latency</span>               <span class="mi">700</span><span class="n">us</span>     <span class="mi">568</span><span class="n">us</span>     <span class="mi">741</span><span class="n">us</span>     <span class="mi">494</span><span class="n">us</span>      <span class="mi">13</span><span class="n">us</span>     <span class="mi">720</span><span class="n">us</span>
<span class="mf">1.96</span><span class="p">,</span><span class="mf">1.96</span><span class="p">,</span><span class="n">Control01</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1345196347</span><span class="p">,</span><span class="mi">8</span><span class="n">G</span><span class="p">,,</span><span class="mi">510</span><span class="p">,</span><span class="mi">97</span><span class="p">,</span><span class="mi">28455</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">30642</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2436</span><span class="p">,</span><span class="mi">95</span><span class="p">,</span><span class="mi">2728545</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mf">696.1</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">16</span><span class="p">,,,,,</span><span class="mi">23726</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">32471</span><span class="p">,</span><span class="mi">53</span><span class="p">,</span><span class="mi">26351</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">23727</span><span class="p">,</span><span class="mi">39</span><span class="p">,</span><span class="mi">15920</span><span class="n">us</span><span class="p">,</span><span class="mi">1910</span><span class="n">ms</span><span class="p">,</span><span class="mi">3485</span><span class="n">ms</span><span class="p">,</span><span class="mi">3206</span><span class="n">us</span><span class="p">,</span><span class="mi">61</span><span class="n">us</span><span class="p">,</span><span class="mi">7308</span><span class="n">us</span><span class="p">,</span><span class="mi">700</span><span class="n">us</span><span class="p">,</span><span class="mi">568</span><span class="n">us</span><span class="p">,</span><span class="mi">741</span><span class="n">us</span><span class="p">,</span><span class="mi">494</span><span class="n">us</span><span class="p">,</span><span class="mi">13</span><span class="n">us</span><span class="p">,</span><span class="mi">720</span><span class="n">us</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="commodity-improved">
<h3>Commodity improved!<a class="headerlink" href="#commodity-improved" title="Permalink to this headline">¶</a></h3>
<p>The first improvement that you can bring to your cluster is definitely
to store your journal in a dedicated disk, ideally a SSD. Here with used a
Dell SSD.</p>
<div class="section" id="rados">
<h4>Rados<a class="headerlink" href="#rados" title="Permalink to this headline">¶</a></h4>
<div class="section" id="rados-write">
<h5>Rados write<a class="headerlink" href="#rados-write" title="Permalink to this headline">¶</a></h5>
<p>3 OSDs</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>         <span class="mf">304.745479</span>
<span class="n">Total</span> <span class="n">writes</span> <span class="n">made</span><span class="p">:</span>      <span class="mi">4661</span>
<span class="n">Write</span> <span class="n">size</span><span class="p">:</span>             <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>     <span class="mf">61.179</span>

<span class="n">Stddev</span> <span class="n">Bandwidth</span><span class="p">:</span>       <span class="mf">38.3555</span>
<span class="n">Max</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">120</span>
<span class="n">Min</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">0</span>
<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>        <span class="mf">1.04608</span>
<span class="n">Stddev</span> <span class="n">Latency</span><span class="p">:</span>         <span class="mf">1.25134</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">10.747</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">0.158048</span>
</pre></div>
</div>
<p>4 OSDs</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>         <span class="mf">309.768170</span>
<span class="n">Total</span> <span class="n">writes</span> <span class="n">made</span><span class="p">:</span>      <span class="mi">4897</span>
<span class="n">Write</span> <span class="n">size</span><span class="p">:</span>             <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>     <span class="mf">63.234</span>

<span class="n">Stddev</span> <span class="n">Bandwidth</span><span class="p">:</span>       <span class="mf">44.439</span>
<span class="n">Max</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">132</span>
<span class="n">Min</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">0</span>
<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>        <span class="mf">1.01208</span>
<span class="n">Stddev</span> <span class="n">Latency</span><span class="p">:</span>         <span class="mf">1.57929</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">12.227</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">0.133978</span>
</pre></div>
</div>
<p>5 OSDs</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>         <span class="mf">300.712355</span>
<span class="n">Total</span> <span class="n">writes</span> <span class="n">made</span><span class="p">:</span>      <span class="mi">6366</span>
<span class="n">Write</span> <span class="n">size</span><span class="p">:</span>             <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>     <span class="mf">84.679</span>

<span class="n">Stddev</span> <span class="n">Bandwidth</span><span class="p">:</span>       <span class="mf">39.9759</span>
<span class="n">Max</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">144</span>
<span class="n">Min</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">0</span>
<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>        <span class="mf">0.755717</span>
<span class="n">Stddev</span> <span class="n">Latency</span><span class="p">:</span>         <span class="mf">0.893649</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">10.881</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">0.137202</span>
</pre></div>
</div>
</div>
<div class="section" id="rados-seq">
<h5>Rados seq<a class="headerlink" href="#rados-seq" title="Permalink to this headline">¶</a></h5>
<p>The seq tests reached the Gigabits limit for a while, only the Write matter.
This is why I only performed 2 tests, one with 3 OSDs and the other with 5
OSDs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>        <span class="mf">207.287149</span>
<span class="n">Total</span> <span class="n">reads</span> <span class="n">made</span><span class="p">:</span>     <span class="mi">5656</span>
<span class="n">Read</span> <span class="n">size</span><span class="p">:</span>            <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>    <span class="mf">109.143</span>

<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>       <span class="mf">0.586076</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">1.76351</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">0.074353</span>
</pre></div>
</div>
<p>5 OSDs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>        <span class="mf">110.200887</span>
<span class="n">Total</span> <span class="n">reads</span> <span class="n">made</span><span class="p">:</span>     <span class="mi">3042</span>
<span class="n">Read</span> <span class="n">size</span><span class="p">:</span>            <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>    <span class="mf">110.417</span>

<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>       <span class="mf">0.579155</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">1.75389</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">0.048253</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="osd">
<h4>OSD<a class="headerlink" href="#osd" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo for j in `seq 10`;do for i in 0 1 2; do ceph osd tell $i bench ; done; done
ok
ok
...
...
</pre></div>
</div>
<p>Average values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">osd</span><span class="o">.</span><span class="mi">0</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">9.154749</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">111</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">9.136084</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">112</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">2</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">6.674849</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">153</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
</pre></div>
</div>
</div>
<div class="section" id="rbd">
<h4>RBD<a class="headerlink" href="#rbd" title="Permalink to this headline">¶</a></h4>
<div class="section" id="dd">
<h5>DD<a class="headerlink" href="#dd" title="Permalink to this headline">¶</a></h5>
<p>Huge block size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dd if=/dev/zero of=/mnt/lol bs=1G count=1 oflag=direct
1073741824 bytes (1.1 GB) copied, 35.4976 s, 30.2 MB/s
</pre></div>
</div>
<p>With the option: filestore flusher set to false</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dd if=/dev/zero of=/mnt/lol bs=1G count=1 oflag=direct
1073741824 bytes (1.1 GB) copied, 17.4976 s, 60.2 MB/s
</pre></div>
</div>
<p>Common block size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dd if=/dev/zero of=/mnt/count bs=4M count=1000 oflag=direct
4194304000 bytes (4.2 GB) copied, 94.2111 s, 44.5 MB/s
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h5>Bonnie++<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Output</span><span class="o">------</span> <span class="o">--</span><span class="n">Sequential</span> <span class="n">Input</span><span class="o">-</span> <span class="o">--</span><span class="n">Random</span><span class="o">-</span>
<span class="n">Concurrency</span>   <span class="mi">1</span>     <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">-</span><span class="n">Rewrite</span><span class="o">-</span> <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">--</span><span class="n">Seeks</span><span class="o">--</span>
<span class="n">Machine</span>        <span class="n">Size</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
<span class="n">Compute01</span>        <span class="mi">8</span><span class="n">G</span>   <span class="mi">495</span>  <span class="mi">98</span> <span class="mi">24954</span>   <span class="mi">3</span> <span class="mi">24548</span>   <span class="mi">2</span>  <span class="mi">2234</span>  <span class="mi">99</span> <span class="mi">2710065</span>  <span class="mi">99</span> <span class="mf">682.2</span>  <span class="mi">21</span>
<span class="n">Latency</span>             <span class="mi">16428</span><span class="n">us</span>    <span class="mi">3108</span><span class="n">ms</span>    <span class="mi">5602</span><span class="n">ms</span>    <span class="mi">3889</span><span class="n">us</span>     <span class="mi">139</span><span class="n">us</span>    <span class="mi">7167</span><span class="n">us</span>
<span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Create</span><span class="o">------</span> <span class="o">--------</span><span class="n">Random</span> <span class="n">Create</span><span class="o">--------</span>
<span class="n">Compute01</span>           <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span> <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span>
            <span class="n">files</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
                <span class="mi">16</span> <span class="mi">26153</span>  <span class="mi">46</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="mi">32226</span>  <span class="mi">54</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span>
<span class="n">Latency</span>               <span class="mi">649</span><span class="n">us</span>     <span class="mi">566</span><span class="n">us</span>     <span class="mi">715</span><span class="n">us</span>     <span class="mi">469</span><span class="n">us</span>      <span class="mi">15</span><span class="n">us</span>     <span class="mi">710</span><span class="n">us</span>
<span class="mf">1.96</span><span class="p">,</span><span class="mf">1.96</span><span class="p">,</span><span class="n">Compute01</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1344845207</span><span class="p">,</span><span class="mi">8</span><span class="n">G</span><span class="p">,,</span><span class="mi">495</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">24954</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">24548</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2234</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">2710065</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mf">682.2</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">16</span><span class="p">,,,,,</span><span class="mi">26153</span><span class="p">,</span><span class="mi">46</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">32226</span><span class="p">,</span><span class="mi">54</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">16428</span><span class="n">us</span><span class="p">,</span><span class="mi">3108</span><span class="n">ms</span><span class="p">,</span><span class="mi">5602</span><span class="n">ms</span><span class="p">,</span><span class="mi">3889</span><span class="n">us</span><span class="p">,</span><span class="mi">139</span><span class="n">us</span><span class="p">,</span><span class="mi">7167</span><span class="n">us</span><span class="p">,</span><span class="mi">649</span><span class="n">us</span><span class="p">,</span><span class="mi">566</span><span class="n">us</span><span class="p">,</span><span class="mi">715</span><span class="n">us</span><span class="p">,</span><span class="mi">469</span><span class="n">us</span><span class="p">,</span><span class="mi">15</span><span class="n">us</span><span class="p">,</span><span class="mi">710</span><span class="n">us</span>
</pre></div>
</div>
<p>With the option: filestore flusher set to false</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Output</span><span class="o">------</span> <span class="o">--</span><span class="n">Sequential</span> <span class="n">Input</span><span class="o">-</span> <span class="o">--</span><span class="n">Random</span><span class="o">-</span>
<span class="n">Concurrency</span>   <span class="mi">1</span>     <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">-</span><span class="n">Rewrite</span><span class="o">-</span> <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">--</span><span class="n">Seeks</span><span class="o">--</span>
<span class="n">Machine</span>        <span class="n">Size</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
<span class="n">Control01</span>        <span class="mi">8</span><span class="n">G</span>   <span class="mi">518</span>  <span class="mi">98</span> <span class="mi">41844</span>   <span class="mi">5</span> <span class="mi">45389</span>   <span class="mi">5</span>  <span class="mi">2559</span>  <span class="mi">99</span> <span class="mi">2726799</span>  <span class="mi">99</span>  <span class="mi">3254</span>  <span class="mi">98</span>
<span class="n">Latency</span>             <span class="mi">50820</span><span class="n">us</span>     <span class="mi">659</span><span class="n">ms</span>   <span class="mi">10272</span><span class="n">ms</span>    <span class="mi">3220</span><span class="n">us</span>     <span class="mi">326</span><span class="n">us</span>   <span class="mi">10390</span><span class="n">us</span>
<span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Create</span><span class="o">------</span> <span class="o">--------</span><span class="n">Random</span> <span class="n">Create</span><span class="o">--------</span>
<span class="n">Control01</span>           <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span> <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span>
            <span class="n">files</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
                <span class="mi">16</span>  <span class="mi">7614</span>  <span class="mi">15</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="mi">30888</span>  <span class="mi">60</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span>
<span class="n">Latency</span>               <span class="mi">715</span><span class="n">us</span>     <span class="mi">554</span><span class="n">us</span>     <span class="mi">842</span><span class="n">us</span>     <span class="mi">481</span><span class="n">us</span>      <span class="mi">12</span><span class="n">us</span>     <span class="mi">716</span><span class="n">us</span>
<span class="mf">1.96</span><span class="p">,</span><span class="mf">1.96</span><span class="p">,</span><span class="n">Control01</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1345157006</span><span class="p">,</span><span class="mi">8</span><span class="n">G</span><span class="p">,,</span><span class="mi">518</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">41844</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">45389</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2559</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">2726799</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">3254</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">16</span><span class="p">,,,,,</span><span class="mi">7614</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">30888</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">50820</span><span class="n">us</span><span class="p">,</span><span class="mi">659</span><span class="n">ms</span><span class="p">,</span><span class="mi">10272</span><span class="n">ms</span><span class="p">,</span><span class="mi">3220</span><span class="n">us</span><span class="p">,</span><span class="mi">326</span><span class="n">us</span><span class="p">,</span><span class="mi">10390</span><span class="n">us</span><span class="p">,</span><span class="mi">715</span><span class="n">us</span><span class="p">,</span><span class="mi">554</span><span class="n">us</span><span class="p">,</span><span class="mi">842</span><span class="n">us</span><span class="p">,</span><span class="mi">481</span><span class="n">us</span><span class="p">,</span><span class="mi">12</span><span class="n">us</span><span class="p">,</span><span class="mi">716</span><span class="n">us</span>
</pre></div>
</div>
<p>With the option: filestore flusher set to false and 4 OSDs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Output</span><span class="o">------</span> <span class="o">--</span><span class="n">Sequential</span> <span class="n">Input</span><span class="o">-</span> <span class="o">--</span><span class="n">Random</span><span class="o">-</span>
<span class="n">Concurrency</span>   <span class="mi">1</span>     <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">-</span><span class="n">Rewrite</span><span class="o">-</span> <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">--</span><span class="n">Seeks</span><span class="o">--</span>
<span class="n">Machine</span>        <span class="n">Size</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
<span class="n">Control01</span>        <span class="mi">8</span><span class="n">G</span>   <span class="mi">509</span>  <span class="mi">98</span> <span class="mi">49789</span>   <span class="mi">6</span> <span class="mi">50924</span>   <span class="mi">6</span>  <span class="mi">2582</span>  <span class="mi">99</span> <span class="mi">2738115</span> <span class="mi">100</span>  <span class="mi">3012</span>  <span class="mi">93</span>
<span class="n">Latency</span>             <span class="mi">15995</span><span class="n">us</span>    <span class="mi">1713</span><span class="n">ms</span>   <span class="mi">13267</span><span class="n">ms</span>    <span class="mi">3191</span><span class="n">us</span>      <span class="mi">41</span><span class="n">us</span>    <span class="mi">9365</span><span class="n">us</span>
<span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Create</span><span class="o">------</span> <span class="o">--------</span><span class="n">Random</span> <span class="n">Create</span><span class="o">--------</span>
<span class="n">Control01</span>           <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span> <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span>
            <span class="n">files</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
                <span class="mi">16</span> <span class="mi">14593</span>  <span class="mi">28</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span>
<span class="n">Latency</span>               <span class="mi">730</span><span class="n">us</span>     <span class="mi">568</span><span class="n">us</span>     <span class="mi">753</span><span class="n">us</span>     <span class="mi">499</span><span class="n">us</span>      <span class="mi">13</span><span class="n">us</span>     <span class="mi">795</span><span class="n">us</span>
<span class="mf">1.96</span><span class="p">,</span><span class="mf">1.96</span><span class="p">,</span><span class="n">Control01</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1345203449</span><span class="p">,</span><span class="mi">8</span><span class="n">G</span><span class="p">,,</span><span class="mi">509</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">49789</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">50924</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2582</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">2738115</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">3012</span><span class="p">,</span><span class="mi">93</span><span class="p">,</span><span class="mi">16</span><span class="p">,,,,,</span><span class="mi">14593</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">15995</span><span class="n">us</span><span class="p">,</span><span class="mi">1713</span><span class="n">ms</span><span class="p">,</span><span class="mi">13267</span><span class="n">ms</span><span class="p">,</span><span class="mi">3191</span><span class="n">us</span><span class="p">,</span><span class="mi">41</span><span class="n">us</span><span class="p">,</span><span class="mi">9365</span><span class="n">us</span><span class="p">,</span><span class="mi">730</span><span class="n">us</span><span class="p">,</span><span class="mi">568</span><span class="n">us</span><span class="p">,</span><span class="mi">753</span><span class="n">us</span><span class="p">,</span><span class="mi">499</span><span class="n">us</span><span class="p">,</span><span class="mi">13</span><span class="n">us</span><span class="p">,</span><span class="mi">795</span><span class="n">us</span>
</pre></div>
</div>
<p>With the option: filestore flusher set to false and 5 OSDs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Output</span><span class="o">------</span> <span class="o">--</span><span class="n">Sequential</span> <span class="n">Input</span><span class="o">-</span> <span class="o">--</span><span class="n">Random</span><span class="o">-</span>
<span class="n">Concurrency</span>   <span class="mi">1</span>     <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">-</span><span class="n">Rewrite</span><span class="o">-</span> <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">--</span><span class="n">Seeks</span><span class="o">--</span>
<span class="n">Machine</span>        <span class="n">Size</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
<span class="n">Control01</span>        <span class="mi">8</span><span class="n">G</span>   <span class="mi">489</span>  <span class="mi">99</span> <span class="mi">58579</span>   <span class="mi">8</span> <span class="mi">61046</span>   <span class="mi">7</span>  <span class="mi">2554</span>  <span class="mi">99</span> <span class="mi">2736782</span>  <span class="mi">99</span>  <span class="mi">3283</span> <span class="mi">102</span>
<span class="n">Latency</span>             <span class="mi">16889</span><span class="n">us</span>     <span class="mi">971</span><span class="n">ms</span>    <span class="mi">5086</span><span class="n">ms</span>    <span class="mi">3238</span><span class="n">us</span>      <span class="mi">53</span><span class="n">us</span>   <span class="mi">10256</span><span class="n">us</span>
<span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Create</span><span class="o">------</span> <span class="o">--------</span><span class="n">Random</span> <span class="n">Create</span><span class="o">--------</span>
<span class="n">Control01</span>           <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span> <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span>
            <span class="n">files</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
                <span class="mi">16</span> <span class="mi">27475</span>  <span class="mi">55</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="mi">21142</span>  <span class="mi">34</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span>
<span class="n">Latency</span>               <span class="mi">670</span><span class="n">us</span>     <span class="mi">558</span><span class="n">us</span>     <span class="mi">730</span><span class="n">us</span>     <span class="mi">470</span><span class="n">us</span>      <span class="mi">12</span><span class="n">us</span>     <span class="mi">722</span><span class="n">us</span>
<span class="mf">1.96</span><span class="p">,</span><span class="mf">1.96</span><span class="p">,</span><span class="n">Control01</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1345202370</span><span class="p">,</span><span class="mi">8</span><span class="n">G</span><span class="p">,,</span><span class="mi">489</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">58579</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">61046</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">2554</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">2736782</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">3283</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="mi">16</span><span class="p">,,,,,</span><span class="mi">27475</span><span class="p">,</span><span class="mi">55</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">21142</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">16889</span><span class="n">us</span><span class="p">,</span><span class="mi">971</span><span class="n">ms</span><span class="p">,</span><span class="mi">5086</span><span class="n">ms</span><span class="p">,</span><span class="mi">3238</span><span class="n">us</span><span class="p">,</span><span class="mi">53</span><span class="n">us</span><span class="p">,</span><span class="mi">10256</span><span class="n">us</span><span class="p">,</span><span class="mi">670</span><span class="n">us</span><span class="p">,</span><span class="mi">558</span><span class="n">us</span><span class="p">,</span><span class="mi">730</span><span class="n">us</span><span class="p">,</span><span class="mi">470</span><span class="n">us</span><span class="p">,</span><span class="mi">12</span><span class="n">us</span><span class="p">,</span><span class="mi">722</span><span class="n">us</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="middle-edge-servers">
<h3>Middle-edge servers!<a class="headerlink" href="#middle-edge-servers" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id3">
<h4>SPECIFICATIONS<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id4">
<h5>SERVERS<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<p>Here the details of my servers:</p>
<ul class="simple">
<li><p>Number of servers: 2</p></li>
<li><p>Hardware type: Dell</p></li>
<li><p>Host model: Dell PowerEdge R520</p></li>
<li><p>Host CPU: Intel Xeon CPU E5-2403 &#64; 1.80GHz x8</p></li>
<li><p>Host RAM: 32 G</p></li>
<li><p>Host disks: 4x RAID 1 of 600GB SAS 15K RPM</p></li>
</ul>
</div>
<div class="section" id="environment-specifications">
<h5>ENVIRONMENT SPECIFICATIONS<a class="headerlink" href="#environment-specifications" title="Permalink to this headline">¶</a></h5>
<p>Running softwares and versions:</p>
<ul class="simple">
<li><p>Operating system: Ubuntu Server</p></li>
<li><p>Version: LTS 12.04</p></li>
<li><p>Ceph version: 0.48 Argonaut</p></li>
<li><p>OSDs numbers: 6; 3 per server</p></li>
<li><p>MON numbers: 1</p></li>
<li><p>Ceph journal: stored on 1 SSD on each server</p></li>
<li><p>Ceph journal size: 2G</p></li>
</ul>
</div>
</div>
<div class="section" id="environement-benchmarks">
<h4>ENVIRONEMENT BENCHMARKS<a class="headerlink" href="#environement-benchmarks" title="Permalink to this headline">¶</a></h4>
<p>In order to be sure that we don’t have any bootleneck, I started to bench
the cluster environment.</p>
<div class="section" id="id5">
<h5>LOCAL DISK BENCHMARKS<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<p>Huge block size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dd if=/dev/zero of=seb bs=1G count=1 oflag=direct
1073741824 bytes (1.1 GB) copied, 4.76773 s, 225 MB/s
</pre></div>
</div>
<p>Common block size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dd if=/dev/zero of=seb bs=4M count=250 oflag=direct
1048576000 bytes (1.0 GB) copied, 3.97997 s, 263 MB/s
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h4>Ceph benchmarks<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id7">
<h5>RADOS internal benchmarker<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<p>Here I seeked the maximum performance, so I used a client bonded links with
Round-robin in order to overcome the Gigabit limit.</p>
<p>Write</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>         <span class="mf">300.518826</span>
<span class="n">Total</span> <span class="n">writes</span> <span class="n">made</span><span class="p">:</span>      <span class="mi">10584</span>
<span class="n">Write</span> <span class="n">size</span><span class="p">:</span>             <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>     <span class="mf">140.876</span>

<span class="n">Stddev</span> <span class="n">Bandwidth</span><span class="p">:</span>       <span class="mf">13.5806</span>
<span class="n">Max</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">184</span>
<span class="n">Min</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">72</span>
<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>        <span class="mf">0.454281</span>
<span class="n">Stddev</span> <span class="n">Latency</span><span class="p">:</span>         <span class="mf">0.214257</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">1.622</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">0.106254</span>
</pre></div>
</div>
<p>Sequential</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>        <span class="mf">297.490987</span>
<span class="n">Total</span> <span class="n">reads</span> <span class="n">made</span><span class="p">:</span>     <span class="mi">10584</span>
<span class="n">Read</span> <span class="n">size</span><span class="p">:</span>            <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>    <span class="mf">142.310</span>

<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>       <span class="mf">0.44962</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">2.03957</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">0.054391</span>
</pre></div>
</div>
<p>III.2. OSDS</p>
<p>OSD internal writes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">osd</span><span class="o">.</span><span class="mi">5</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">1.573642</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">650</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">2.070818</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">494</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">3</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">1.593774</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">642</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">2</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">2.027097</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">505</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">4</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">1.632214</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">627</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">0</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">2.082020</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">491</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
</pre></div>
</div>
<p>III.3. RBD
III.3.1. DDs</p>
<p>Huge block size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dd if=/dev/zero of=/mnt/lol bs=1G count=1 oflag=direct
1073741824 bytes (1.1 GB) copied, 7.66643 s, 140 MB/s
</pre></div>
</div>
<p>Common block size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dd if=/dev/zero of=/mnt/lol bs=4M count=250 oflag=direct
1048576000 bytes (1.0 GB) copied, 11.3414 s, 92.5 MB/s
</pre></div>
</div>
<p>III.3.2. Bonnie++</p>
<p>Bonnie++:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Output</span><span class="o">------</span> <span class="o">--</span><span class="n">Sequential</span> <span class="n">Input</span><span class="o">-</span> <span class="o">--</span><span class="n">Random</span><span class="o">-</span>
<span class="n">Concurrency</span>   <span class="mi">1</span>     <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">-</span><span class="n">Rewrite</span><span class="o">-</span> <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">--</span><span class="n">Seeks</span><span class="o">--</span>
<span class="n">Machine</span>        <span class="n">Size</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
<span class="n">BenchClient</span>      <span class="mi">8</span><span class="n">G</span>   <span class="mi">900</span>  <span class="mi">98</span> <span class="mi">87434</span>   <span class="mi">8</span> <span class="mi">144289</span>  <span class="mi">11</span>  <span class="mi">3032</span>  <span class="mi">99</span> <span class="mi">7704813</span>  <span class="mi">99</span>  <span class="mi">4202</span>  <span class="mi">96</span>
<span class="n">Latency</span>             <span class="mi">19407</span><span class="n">us</span>   <span class="mi">20065</span><span class="n">us</span>     <span class="mi">168</span><span class="n">us</span>    <span class="mi">3957</span><span class="n">us</span>     <span class="mi">139</span><span class="n">us</span>      <span class="mi">73</span><span class="n">us</span>
<span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Create</span><span class="o">------</span> <span class="o">--------</span><span class="n">Random</span> <span class="n">Create</span><span class="o">--------</span>
<span class="n">BenchClient</span>         <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span> <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span>
            <span class="n">files</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
                <span class="mi">16</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span>
<span class="n">Latency</span>               <span class="mi">316</span><span class="n">us</span>     <span class="mi">788</span><span class="n">us</span>     <span class="mi">854</span><span class="n">us</span>     <span class="mi">348</span><span class="n">us</span>      <span class="mi">16</span><span class="n">us</span>     <span class="mi">378</span><span class="n">us</span>
<span class="mf">1.96</span><span class="p">,</span><span class="mf">1.96</span><span class="p">,</span><span class="n">BenchClient</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1345571416</span><span class="p">,</span><span class="mi">8</span><span class="n">G</span><span class="p">,,</span><span class="mi">900</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">87434</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">144289</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">3032</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">7704813</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">4202</span><span class="p">,</span><span class="mi">96</span><span class="p">,</span><span class="mi">16</span><span class="p">,,,,,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">19407</span><span class="n">us</span><span class="p">,</span><span class="mi">20065</span><span class="n">us</span><span class="p">,</span><span class="mi">168</span><span class="n">us</span><span class="p">,</span><span class="mi">3957</span><span class="n">us</span><span class="p">,</span><span class="mi">139</span><span class="n">us</span><span class="p">,</span><span class="mi">73</span><span class="n">us</span><span class="p">,</span><span class="mi">316</span><span class="n">us</span><span class="p">,</span><span class="mi">788</span><span class="n">us</span><span class="p">,</span><span class="mi">854</span><span class="n">us</span><span class="p">,</span><span class="mi">348</span><span class="n">us</span><span class="p">,</span><span class="mi">16</span><span class="n">us</span><span class="p">,</span><span class="mi">378</span><span class="n">us</span>
</pre></div>
</div>
<p>Insane servers!</p>
<p>Specifications
I.1. Servers</p>
<p>Here the details of my servers:</p>
<ul class="simple">
<li><p>Hardware type: Dell</p></li>
<li><p>Host model: Dell PowerEdge R620</p></li>
<li><p>Host CPU: Intel Xeon CPU E5-2660 0 &#64; 2.20GHz x32</p></li>
<li><p>Host RAM: 65 G</p></li>
<li><dl class="simple">
<dt>Host disks: SSD DELL</dt><dd><ul>
<li><p>2x RAID 1 of 100G</p></li>
<li><p>2x RAID 1 of 200G</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>I.2. ENVIRONEMENT SPECIFICATIONS</p>
<p>Running softwares and versions:</p>
<ul class="simple">
<li><p>Operating system: Ubuntu Server</p></li>
<li><p>Version: LTS 12.04</p></li>
<li><p>Ceph version: 0.48 Argonaut</p></li>
<li><p>OSDs numbers: 3</p></li>
<li><p>MON numbers: 3</p></li>
<li><p>Ceph journal: stored on 1 SSD on each server</p></li>
<li><p>Ceph journal size: 2G</p></li>
</ul>
<ol class="upperroman simple" start="2">
<li><p>ENVIRONEMENT BENCHMARKS</p></li>
</ol>
<p>In order to be sure that we don’t have any bootleneck, I started to bench the
cluster environment.</p>
<p>II.1. LOCAL DISK BENCHMARKS</p>
<p>R Note about the SSDs. The first hit, hits the SSD internal buffer so you get
amazing performance. Below the first hit (the buffer) and the second one
(and so on).</p>
<p>Huge block size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dd if=/dev/zero of=seb bs=1G count=1 oflag=direct
1073741824 bytes (1.1 GB) copied, 3.72137 s, 289 MB/s
1073741824 bytes (1.1 GB) copied, 6.79279 s, 158 MB/s
</pre></div>
</div>
<p>Common block size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ dd if=/dev/zero of=seb bs=4M count=250 oflag=direct
1048576000 bytes (1.0 GB) copied, 2.89631 s, 362 MB/s
1048576000 bytes (1.0 GB) copied, 7.32222 s, 143 MB/s
</pre></div>
</div>
<p>III. Ceph benchmarks
III.1. RADOS INTERNAL BENCHMARKER</p>
<p>Write</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>         <span class="mf">300.562480</span>
<span class="n">Total</span> <span class="n">writes</span> <span class="n">made</span><span class="p">:</span>      <span class="mi">6575</span>
<span class="n">Write</span> <span class="n">size</span><span class="p">:</span>             <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>     <span class="mf">87.503</span>

<span class="n">Stddev</span> <span class="n">Bandwidth</span><span class="p">:</span>       <span class="mf">5.31243</span>
<span class="n">Max</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">100</span>
<span class="n">Min</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">60</span>
<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>        <span class="mf">0.731271</span>
<span class="n">Stddev</span> <span class="n">Latency</span><span class="p">:</span>         <span class="mf">0.464997</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">1.80529</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">0.15539</span>
</pre></div>
</div>
<p>With a dedicated private network:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>         <span class="mf">300.994975</span>
<span class="n">Total</span> <span class="n">writes</span> <span class="n">made</span><span class="p">:</span>      <span class="mi">8306</span>
<span class="n">Write</span> <span class="n">size</span><span class="p">:</span>             <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>     <span class="mf">110.381</span>

<span class="n">Stddev</span> <span class="n">Bandwidth</span><span class="p">:</span>       <span class="mf">23.0465</span>
<span class="n">Max</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">156</span>
<span class="n">Min</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">56</span>
<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>        <span class="mf">0.579727</span>
<span class="n">Stddev</span> <span class="n">Latency</span><span class="p">:</span>         <span class="mf">0.338156</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">1.88386</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">0.120633</span>
</pre></div>
</div>
<p>With a dedicated private network and round-robin bonded clients:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>         <span class="mf">300.330944</span>
<span class="n">Total</span> <span class="n">writes</span> <span class="n">made</span><span class="p">:</span>      <span class="mi">11338</span>
<span class="n">Write</span> <span class="n">size</span><span class="p">:</span>             <span class="mi">4194304</span>
<span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>     <span class="mf">151.007</span>

<span class="n">Stddev</span> <span class="n">Bandwidth</span><span class="p">:</span>       <span class="mf">28.6038</span>
<span class="n">Max</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">204</span>
<span class="n">Min</span> <span class="n">bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span> <span class="mi">64</span>
<span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>        <span class="mf">0.423753</span>
<span class="n">Stddev</span> <span class="n">Latency</span><span class="p">:</span>         <span class="mf">0.207152</span>
<span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">1.30265</span>
<span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>            <span class="mf">0.117577</span>
</pre></div>
</div>
<p>Sequential</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>        <span class="mf">234.377939</span>
 <span class="n">Total</span> <span class="n">reads</span> <span class="n">made</span><span class="p">:</span>     <span class="mi">6575</span>
 <span class="n">Read</span> <span class="n">size</span><span class="p">:</span>            <span class="mi">4194304</span>
 <span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>    <span class="mf">112.212</span>

 <span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>       <span class="mf">0.57021</span>
 <span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">1.40867</span>
 <span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">0.0825</span>
</pre></div>
</div>
<p>With a dedicated private network:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>        <span class="mf">296.067941</span>
 <span class="n">Total</span> <span class="n">reads</span> <span class="n">made</span><span class="p">:</span>     <span class="mi">8306</span>
 <span class="n">Read</span> <span class="n">size</span><span class="p">:</span>            <span class="mi">4194304</span>
 <span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>    <span class="mf">112.217</span>

 <span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>       <span class="mf">0.570205</span>
 <span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">1.61435</span>
 <span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">0.085098</span>
</pre></div>
</div>
<p>With a dedicated private network and round-robin bonded clients:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Total</span> <span class="n">time</span> <span class="n">run</span><span class="p">:</span>        <span class="mf">255.446166</span>
 <span class="n">Total</span> <span class="n">reads</span> <span class="n">made</span><span class="p">:</span>     <span class="mi">11338</span>
 <span class="n">Read</span> <span class="n">size</span><span class="p">:</span>            <span class="mi">4194304</span>
 <span class="n">Bandwidth</span> <span class="p">(</span><span class="n">MB</span><span class="o">/</span><span class="n">sec</span><span class="p">):</span>    <span class="mf">177.540</span>

 <span class="n">Average</span> <span class="n">Latency</span><span class="p">:</span>       <span class="mf">0.360375</span>
 <span class="n">Max</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">1.07688</span>
 <span class="n">Min</span> <span class="n">latency</span><span class="p">:</span>           <span class="mf">0.056551</span>
</pre></div>
</div>
<p>III.2. OSDS</p>
<p>OSD internal writes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">osd</span><span class="o">.</span><span class="mi">0</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">4.937443</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">207</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">1</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">4.847808</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">211</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
<span class="n">osd</span><span class="o">.</span><span class="mi">2</span> <span class="p">[</span><span class="n">INF</span><span class="p">]</span> <span class="n">bench</span><span class="p">:</span> <span class="n">wrote</span> <span class="mi">1024</span> <span class="n">MB</span> <span class="ow">in</span> <span class="n">blocks</span> <span class="n">of</span> <span class="mi">4096</span> <span class="n">KB</span> <span class="ow">in</span> <span class="mf">4.937443</span> <span class="n">sec</span> <span class="n">at</span> <span class="mi">207</span> <span class="n">MB</span><span class="o">/</span><span class="n">sec</span>
</pre></div>
</div>
<p>III. RBD
III.1. DDS</p>
<p>Huge block size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo dd if=/dev/zero of=/mnt/bench bs=1G count=1 oflag=direct
1073741824 bytes (1.1 GB) copied, 11.8962 s, 90.3 MB/s
</pre></div>
</div>
<p>Common block size:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo dd if=/dev/zero of=/mnt/lal bs=4M count=1000 oflag=direct
4194304000 bytes (4.2 GB) copied, 47.0956 s, 89.1 MB/s
</pre></div>
</div>
<p>With a dedicated private network</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo dd if=/dev/zero of=/mnt/bench bs=1G count=1 oflag=direct
1073741824 bytes (1.1 GB) copied, 10.358 s, 104 MB/s
</pre></div>
</div>
<p>With a dedicated private network and round-robin bonded clients:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo dd if=/dev/zero of=/mnt/bench bs=1G count=1 oflag=direct
1073741824 bytes (1.1 GB) copied, 6.8115 s, 158 MB/s
</pre></div>
</div>
<p>III.2. bonnie++</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Output</span><span class="o">------</span> <span class="o">--</span><span class="n">Sequential</span> <span class="n">Input</span><span class="o">-</span> <span class="o">--</span><span class="n">Random</span><span class="o">-</span>
<span class="n">Concurrency</span>   <span class="mi">1</span>     <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">-</span><span class="n">Rewrite</span><span class="o">-</span> <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">--</span><span class="n">Seeks</span><span class="o">--</span>
<span class="n">Machine</span>        <span class="n">Size</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
<span class="n">BenchClient</span>      <span class="mi">8</span><span class="n">G</span>   <span class="mi">884</span>  <span class="mi">97</span> <span class="mi">67352</span>   <span class="mi">6</span> <span class="mi">91087</span>   <span class="mi">7</span>  <span class="mi">3183</span>  <span class="mi">99</span> <span class="mi">7721231</span>  <span class="mi">99</span>  <span class="mi">4339</span> <span class="mi">104</span>
<span class="n">Latency</span>             <span class="mi">19237</span><span class="n">us</span>    <span class="mi">2171</span><span class="n">us</span>     <span class="mi">160</span><span class="n">us</span>    <span class="mi">3768</span><span class="n">us</span>     <span class="mi">141</span><span class="n">us</span>     <span class="mi">110</span><span class="n">us</span>
<span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Create</span><span class="o">------</span> <span class="o">--------</span><span class="n">Random</span> <span class="n">Create</span><span class="o">--------</span>
<span class="n">BenchClient</span>         <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span> <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span>
            <span class="n">files</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
                <span class="mi">16</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span>
<span class="n">Latency</span>              <span class="mi">1317</span><span class="n">us</span>     <span class="mi">818</span><span class="n">us</span>     <span class="mi">869</span><span class="n">us</span>     <span class="mi">288</span><span class="n">us</span>      <span class="mi">15</span><span class="n">us</span>     <span class="mi">526</span><span class="n">us</span>
<span class="mf">1.96</span><span class="p">,</span><span class="mf">1.96</span><span class="p">,</span><span class="n">BenchClient</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1344648723</span><span class="p">,</span><span class="mi">8</span><span class="n">G</span><span class="p">,,</span><span class="mi">884</span><span class="p">,</span><span class="mi">97</span><span class="p">,</span><span class="mi">67352</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">91087</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">3183</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">7721231</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">4339</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="mi">16</span><span class="p">,,,,,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">19237</span><span class="n">us</span><span class="p">,</span><span class="mi">2171</span><span class="n">us</span><span class="p">,</span><span class="mi">160</span><span class="n">us</span><span class="p">,</span><span class="mi">3768</span><span class="n">us</span><span class="p">,</span><span class="mi">141</span><span class="n">us</span><span class="p">,</span><span class="mi">110</span><span class="n">us</span><span class="p">,</span><span class="mi">1317</span><span class="n">us</span><span class="p">,</span><span class="mi">818</span><span class="n">us</span><span class="p">,</span><span class="mi">869</span><span class="n">us</span><span class="p">,</span><span class="mi">288</span><span class="n">us</span><span class="p">,</span><span class="mi">15</span><span class="n">us</span><span class="p">,</span><span class="mi">526</span><span class="n">us</span>
</pre></div>
</div>
<p>With a dedicated private network and round-robin bonded clients:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Output</span><span class="o">------</span> <span class="o">--</span><span class="n">Sequential</span> <span class="n">Input</span><span class="o">-</span> <span class="o">--</span><span class="n">Random</span><span class="o">-</span>
<span class="n">Concurrency</span>   <span class="mi">1</span>     <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">-</span><span class="n">Rewrite</span><span class="o">-</span> <span class="o">-</span><span class="n">Per</span> <span class="n">Chr</span><span class="o">-</span> <span class="o">--</span><span class="n">Block</span><span class="o">--</span> <span class="o">--</span><span class="n">Seeks</span><span class="o">--</span>
<span class="n">Machine</span>        <span class="n">Size</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span> <span class="n">K</span><span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
<span class="n">BenchClient</span>      <span class="mi">8</span><span class="n">G</span>   <span class="mi">888</span>  <span class="mi">98</span> <span class="mi">76432</span>   <span class="mi">8</span> <span class="mi">148261</span>  <span class="mi">11</span>  <span class="mi">3371</span>  <span class="mi">99</span> <span class="mi">7720435</span> <span class="mi">100</span>  <span class="mi">4450</span> <span class="mi">106</span>
<span class="n">Latency</span>             <span class="mi">19265</span><span class="n">us</span>     <span class="mi">361</span><span class="n">ms</span>     <span class="mi">154</span><span class="n">us</span>    <span class="mi">3664</span><span class="n">us</span>     <span class="mi">131</span><span class="n">us</span>      <span class="mi">66</span><span class="n">us</span>
<span class="n">Version</span>  <span class="mf">1.96</span>       <span class="o">------</span><span class="n">Sequential</span> <span class="n">Create</span><span class="o">------</span> <span class="o">--------</span><span class="n">Random</span> <span class="n">Create</span><span class="o">--------</span>
<span class="n">BenchClient</span>         <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span> <span class="o">-</span><span class="n">Create</span><span class="o">--</span> <span class="o">--</span><span class="n">Read</span><span class="o">---</span> <span class="o">-</span><span class="n">Delete</span><span class="o">--</span>
            <span class="n">files</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>  <span class="o">/</span><span class="n">sec</span> <span class="o">%</span><span class="n">CP</span>
                <span class="mi">16</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span> <span class="o">+++++</span> <span class="o">+++</span>
<span class="n">Latency</span>              <span class="mi">1273</span><span class="n">us</span>     <span class="mi">795</span><span class="n">us</span>     <span class="mi">849</span><span class="n">us</span>     <span class="mi">285</span><span class="n">us</span>      <span class="mi">15</span><span class="n">us</span>     <span class="mi">374</span><span class="n">us</span>
<span class="mf">1.96</span><span class="p">,</span><span class="mf">1.96</span><span class="p">,</span><span class="n">BenchClient</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1345068839</span><span class="p">,</span><span class="mi">8</span><span class="n">G</span><span class="p">,,</span><span class="mi">888</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">76432</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">148261</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">3371</span><span class="p">,</span><span class="mi">99</span><span class="p">,</span><span class="mi">7720435</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">4450</span><span class="p">,</span><span class="mi">106</span><span class="p">,</span><span class="mi">16</span><span class="p">,,,,,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="o">+++++</span><span class="p">,</span><span class="o">+++</span><span class="p">,</span><span class="mi">19265</span><span class="n">us</span><span class="p">,</span><span class="mi">361</span><span class="n">ms</span><span class="p">,</span><span class="mi">154</span><span class="n">us</span><span class="p">,</span><span class="mi">3664</span><span class="n">us</span><span class="p">,</span><span class="mi">131</span><span class="n">us</span><span class="p">,</span><span class="mi">66</span><span class="n">us</span><span class="p">,</span><span class="mi">1273</span><span class="n">us</span><span class="p">,</span><span class="mi">795</span><span class="n">us</span><span class="p">,</span><span class="mi">849</span><span class="n">us</span><span class="p">,</span><span class="mi">285</span><span class="n">us</span><span class="p">,</span><span class="mi">15</span><span class="n">us</span><span class="p">,</span><span class="mi">374</span><span class="n">us</span>
</pre></div>
</div>
<p>Some final thoughts:</p>
<ul class="simple">
<li><p>As many OSDs you have as better is the load-balance in the cluster. Let’s
assume that you use 1 disk per OSD, it means that you will prefer 2 disk of
500G instead of 1T disk.</p></li>
<li><p>The usage of a SSD dramatically improves your OSD’s performance</p></li>
<li><p>Replica count of 2 brings more performance than a replica count of 3, but
it’s less secure</p></li>
<li><p>Using a dedicated private network for the internal OSDs replication really
improve the performance</p></li>
<li><p>It’s really easy with decent hardware to overcome the 1G bandwidth limitation</p></li>
<li><p>Setting the filestore flusher option to false can radically improve your
performance, mainly on old system</p></li>
<li><p>Even if more pg means better load-balance, setting a large number of pg
doesn’t enhance your performance</p></li>
</ul>
<p>NOTE: This benchmarking session with Ceph was really exciting since it forced
me to dive into Ceph’s meanders. According to my result, it was pretty easy
to touch the limitation of a 1G network, even with several optimizations like
round-robin bounding. I will be happy to work with 10G switches when those
onces will be affordable, with this constat we are far away from the
‘commodity hardware’ statement.</p>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="postgresql.html" title="Postgresql"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Benchmarking"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Enterprise Architecture  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Benchmarking</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Peter Preeper.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.2.1.
    </div>
  </body>
</html>